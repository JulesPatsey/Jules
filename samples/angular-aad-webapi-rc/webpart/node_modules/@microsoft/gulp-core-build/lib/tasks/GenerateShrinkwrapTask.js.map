{"version":3,"sources":["tasks/GenerateShrinkwrapTask.ts"],"names":[],"mappings":";;;;;;AAAA,yBAAyB,YAAY,CAAC,CAAA;AAEtC,IAAY,aAAa,WAAM,eAAe,CAAC,CAAA;AAC/C,IAAY,MAAM,WAAM,QAAQ,CAAC,CAAA;AACjC,IAAY,EAAE,WAAM,IAAI,CAAC,CAAA;AACzB,IAAY,IAAI,WAAM,MAAM,CAAC,CAAA;AAE7B;;;;GAIG;AACH;IAA4C,0CAAY;IAAxD;QAA4C,8BAAY;QAC/C,SAAI,GAAW,qBAAqB,CAAC;IA8B9C,CAAC;IA5BQ,4CAAW,GAAlB,UAAmB,IAAmB;QACpC,IAAM,gBAAgB,GAAW,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,qBAAqB,CAAC,CAAC;QAE7F,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;YAC7C,IAAI,CAAC,sBAAsB,CAAC,gBAAgB,CAAC,CAAC;QAChD,CAAC;QAED,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QAC9B,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAEpC,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QAC/B,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QAErC,IAAI,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;QACzC,aAAa,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAC;QAE/C,MAAM,CAAC;IACT,CAAC;IAEO,uDAAsB,GAA9B,UAA+B,UAAkB;QAC/C,IAAI,CAAC;YACH,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC1B,CAAE;QAAA,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACX,MAAM,IAAI,KAAK,CAAC,KAAG,CAAC,CAAC,OAAO,GAAG,EAAE,CAAC,GAAG,2HACsB,CAAC,CAAC;QAC/D,CAAC;IACH,CAAC;IACH,6BAAC;AAAD,CA/BA,AA+BC,CA/B2C,mBAAQ,GA+BnD;AA/BY,8BAAsB,yBA+BlC,CAAA","file":"tasks/GenerateShrinkwrapTask.js","sourcesContent":["import { GulpTask } from './GulpTask';\r\nimport gulpType = require('gulp');\r\nimport * as child_process from 'child_process';\r\nimport * as rimraf from 'rimraf';\r\nimport * as os from 'os';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * This provides a convenient way to more consistently generate a shrinkwrap file in\r\n * a desired manner as a gulp task, as there are many consistency issues with just\r\n * running npm-shrinkwrap directly.\r\n */\r\nexport class GenerateShrinkwrapTask extends GulpTask<{}> {\r\n  public name: string = 'generate-shrinkwrap';\r\n\r\n  public executeTask(gulp: gulpType.Gulp): NodeJS.ReadWriteStream {\r\n    const pathToShrinkwrap: string = path.join(this.buildConfig.rootPath, 'npm-shrinkwrap.json');\r\n\r\n    if (this.fileExists(pathToShrinkwrap)) {\r\n      this.log(`Remove existing shrinkwrap file.`);\r\n      this._dangerouslyDeletePath(pathToShrinkwrap);\r\n    }\r\n\r\n    this.log(`Running npm prune`);\r\n    child_process.execSync('npm prune');\r\n\r\n    this.log(`Running npm update`);\r\n    child_process.execSync('npm update');\r\n\r\n    this.log(`Running npm shrinkwrap --dev`);\r\n    child_process.execSync('npm shrinkwrap --dev');\r\n\r\n    return;\r\n  }\r\n\r\n  private _dangerouslyDeletePath(folderPath: string): void {\r\n    try {\r\n      rimraf.sync(folderPath);\r\n    } catch (e) {\r\n      throw new Error(`${e.message}${os.EOL}Often this is caused by a file lock from a process\r\n       such as your text editor, command prompt, or \"gulp serve\"`);\r\n    }\r\n  }\r\n}"],"sourceRoot":"..\\..\\src"}