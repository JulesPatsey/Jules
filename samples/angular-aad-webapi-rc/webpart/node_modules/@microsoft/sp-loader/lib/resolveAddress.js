"use strict";
var SPSystemJsComponentLoader_1 = require('./SPSystemJsComponentLoader');
function resolveAddress(manifest, resourceName) {
    var resolveLocalizedModuleConfiguration = function (moduleConfiguration) {
        var currentLocale = SPSystemJsComponentLoader_1.default._currentLocale;
        if (moduleConfiguration.paths) {
            if (currentLocale) {
                for (var locale in moduleConfiguration.paths) {
                    if (locale && locale.toUpperCase() === currentLocale.toUpperCase() && moduleConfiguration.paths[locale]) {
                        return moduleConfiguration.paths[locale];
                    }
                }
            }
        }
        return moduleConfiguration.defaultPath;
    };
    var resolvePath = function (path) {
        if (typeof path === 'string') {
            return path;
        }
        else {
            return path.default;
        }
    };
    var resolveModuleConfiguration = function (moduleName, moduleConfiguration) {
        if (moduleConfiguration) {
            switch (moduleConfiguration.type) {
                case 'component':
                    return resolvePath(moduleConfiguration.failoverPath);
                case 'path':
                    return resolvePath(moduleConfiguration.path);
                case 'localizedPath':
                    return resolvePath(resolveLocalizedModuleConfiguration(moduleConfiguration));
                case null: 
                case undefined:
                default:
                    return moduleName;
            }
        }
        else {
            return moduleName;
        }
    };
    var moduleConfiguration = manifest.loaderConfig.scriptResources[resourceName];
    var address = resolveModuleConfiguration(resourceName, moduleConfiguration);
    if (!address.match(/^https?\:\/\//)) {
        var moduleBaseUrl = manifest.loaderConfig.internalModuleBaseUrls[0].replace(/\/+$/, '');
        address = moduleBaseUrl + "/" + address;
    }
    return address;
}
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = resolveAddress;
